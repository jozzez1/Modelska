\documentclass[12pt, a4paper]{article}
\usepackage[slovene]{babel}
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage{amsmath, amssymb}

\renewcommand{\r}{
    \ensuremath{\mathbf{r}}
}

\newcommand{\p}{
    \ensuremath{\mathbf{p}}
}

\renewcommand{\L}{
    \ensuremath{\mathcal{L}}
}

\newcommand{\e}{
    \ensuremath{\mathrm{e}}
}

\newcommand{\sfrac}[2]{
    \ensuremath{\textstyle{\frac{#1}{#2}}}
}

\newcommand{\Frac}[2]{
    \ensuremath{\displaystyle{\frac{#1}{#2}}}
}

\newcommand{\der}[3][]{
    \ensuremath{ \frac{\partial^{#1} #2}{\partial #3^{#1}} }
}

\newcommand{\pl}{
    \ensuremath{\dot{+}}
}

\begin{document}

\section{Navodilo}

Razi\v s\v ci prostor kro\v znih orbit planeta okrog dvojne zvezde v pribli\v zku zanemarljive mase
planeta. Koliko parametrov ima model?

\section{Razmislek}

V tem primeru imamo veliko sre\v co, saj je sistem zaprt, kar pomeni $\dot{E} = 0$. Zaradi tega bomo
za re\v sevanje problema napravili simplekti\v cen integrator s pomo\v cjo Trotter-Suzukijevega
razcepa, za katerega pa ne potrebujemo Newtonovega zakona, ampak samo klasi\v cno hamiltonko:
\begin{equation}
    H = \frac{1}{2}\sum_{k = 1}^N \frac{|\p_k|^2}{m_k} - \frac{\kappa}{4\pi}\sum_{k,\ell}
        \frac{m_k m_\ell}{|\r_k - \r_\ell|},
    \label{hamilton}
\end{equation}
vektorje smo ozna\v cili z mastnim tiskom. Dinamiko dolo\v cimo prek Liouvillovega operatorja $\L$:
\begin{equation}
    -i\L \equiv \{\bullet, H\}, \quad \dot{x}(t) = -i\L x(t),
    \label{liouville}
\end{equation}
kjer je $\{\bullet, \bullet\}$ Poissonov oklepaj, $x$ pa neka koli\v cina. Iz Ena\v cbe~\eqref{liouville}
dobimo klasi\v cni propagator $U(t)$:
\begin{equation}
    x(t + \delta t) = U(\delta t)\ x(t) = \exp(\delta t\L)\ x(t),
\end{equation}
katerega lahko razstavimo na kineti\v cni in potencialni del. Propagator se potem glasi
\begin{equation}
    \exp(\delta t \L) = \exp(\delta t \{\bullet, T\} + \delta t \{\bullet, V\}),
    \label{propagator}
\end{equation}
zanj pa velja Trotterjeva formula
\begin{equation}
    \exp(\delta t\{\bullet,T\} + \delta t\{\bullet,V\}) = \lim_{n \to \infty}
        \Big(\exp(\sfrac{\delta t}{n}\{\bullet,T\})\exp(\sfrac{\delta t}{n}\{\bullet,V\})\Big)^n.
\end{equation}
Tega izraza seveda ne bomo ra\v cunali, saj bi potrebovali neskon\v cen produkt. Raje bi konsistentno z
natan\v cnostjo pobrali le kon\v cno mnogo faktorjev. Tu nam na pomo\v c prisko\v ci
Baker-Campbell-Hausorff-ova identiteta:
\[
    C = \log{\e^{A + B}} = A + B + \sfrac{1}{2}[A,B] + \sfrac{1}{12}\big[A,[A,B]\big] -
        \sfrac{1}{12}\big[B,[A,B]\big] +\ldots
\]
S pomo\v cjo le-te si lahko zamislimo pogoja
\begin{align}
    \e^C &= \e^{c_1 A}\e^{d_1 B}\e^{c_2 A}\e^{d_2 B}\e^{c_3 A}\cdot \ldots \cdot \e^{c_n A}\e^{d_n B} \\
    \e^C &= \e^{w_1 A}\e^{z_1 B}\e^{w_2 A}\e^{z_2 B}\e^{w_3 A}\cdot \ldots \cdot \e^{z_n B}\e^{w_{n+1} A}
\end{align}
in izra\v cunamo koeficiente $c_i$ in $d_j$ nesimetri\v cne oz. koeficiente $w_i$, $z_i$ simetrizirane
formule da bo to res do reda natan\v cnosti $n$, ki je sorazmeren s \v stevilom prisotnih faktorjev.
Simetrizirane formule so natan\v cnej\v se zato bomo uporabili sledenje. Koeficienti so v splo\v snem
lahko kompleksni. S pomo\v cjo prej\v snjih identitet lahko propagator v ena\v cbi~\eqref{propagator}
zapi\v semo kot npr.
\[
    \exp(\delta t\L) \approx \exp\big(\sfrac{\delta t}{2}\{\bullet, T\}\big)
    \exp\big(\delta t\{\bullet, V\}\big)
    \exp\big(\sfrac{\delta t}{2}\{\bullet, T\}\big) + \mathcal{O}(\delta t^3).
\]
Ta shema je Trotter-Suzukijev razcep reda $2$ in jo ozna\v cimo z $S_2(\delta t)$. Na preprost na\v cin
lahko od tod dobimo Trotter-Suzukijev razcep reda $4$,
\[
    S_4 (\delta t) = S_2(x_0 \delta t) S_2(x_1 \delta t) S_2(x_0 \delta t) + \mathcal{O}(\delta t^5), \quad
    x_0 = \frac{1}{2 - \sqrt[3]{2}},\ x_1 = -\frac{\sqrt[3]{2}}{2 - \sqrt[3]{2}},
\]
ki ga bomo uporabljali tekom te doma\v ce naloge, saj je \v ze kar precej natan\v cen, poleg tega, da so
koeficienti \v se vedno vsi realni.

\subsection{Prosti parametri}

Da preverimo \v stevilo prostih parametrov moramo hamiltonko~\eqref{hamilton} pretvoriti v brezdimenzijsko
obliko. Energija se bo \v zal ohranjala samo, kadar upo\v stevamo tudi maso planeta, tako da je ne bomo
zanemarili. Naj bo $m_3$ masa planeta, $m_1$ in $m_2$ pa naj bosta masi zvezde. Definirajmo brezdimenzijski
masi
\begin{equation}
    M_1 \equiv \frac{m_1}{m_3}, \quad M_2 \equiv \frac{m_2}{m_3}.
\end{equation}
Nekaj svobode imamo \v se za to, kako bomo merili dol\v zine. Smiselno je, da bi merili v enotah oddaljenosti
zvezd na za\v cetku, tj. $\rho_0 = |\r_1 (0) - \r_2 (0)|$. Da bomo lahko naredili polno brezdimenzijsko
transformacijo potrebujemo \v se skalo za \v cas. Merili ga bomo v enotah $\tau$, ki je
\[
    \frac{1}{\tau^2} \equiv \frac{\kappa m_3}{4\pi\rho_0^3}.
\]
Hamiltonian se potem glasi
\begin{align*}
    H =& \frac{\rho_0^2}{2 m_3\tau^2} \big(\sfrac{1}{M_1}|\p_1|^2\tau^2/\rho_0^2 + \sfrac{1}{M_2}|\p_2|^2\tau^2/\rho_0^2 +
        |\p_3|^2\tau^2/\rho_0^2\big) -\\
       &- \Frac{\kappa m_3^2}{4\pi\rho_0}\bigg(\Frac{M_1}{|\r_1 - \r_3|/\rho_0} + \Frac{M_2}{|\r_2 - \r_3|/\rho_0} +
        \Frac{M_1 M_2}{|\r_1 - \r_2|/\rho_0}\bigg),
\end{align*}
kjer lahko konstanto $\kappa m_3^2/4\pi\rho_0$ izrazimo s $\tau$ in dobimo $m_3\rho_0^2/\tau^2$.
Sedaj uvedemo brezdimenzijske impulze in brezdimenzijske dol\v zine
\begin{equation}
    \frac{\p}{m_3\rho_0/\tau} \mapsto \p, \quad \frac{\r}{\rho_0} \mapsto \r,
\end{equation}
kar hamiltonian poenostavi v
\begin{align*}
    H =& \frac{m_3\rho_0^2}{2\tau^2} (\sfrac{1}{M_1}|\p_1|^2 + \sfrac{1}{M_2}|\p_2|^2 + |\p_3|^2) -\\
       &- \Frac{m_3\rho_0^2}{\tau^2}\bigg(\Frac{M_1}{|\r_1 - \r_3|} + \Frac{M_2}{|\r_2 - \r_3|} +
        \Frac{M_1 M_2}{|\r_1 - \r_2|}\bigg).
\end{align*}
Kar nam \v se preostana je, da uvedemo brezdimenzijsko transformacijo in energijo merimo v enotah
$m_3\rho_0^2/\tau^2$, tj.
\[
    \frac{\tau^2}{\rho_0^2 m_3}H \mapsto H
\]
in dobimo brezdimenzijski hamiltonian
\begin{equation}
    H = \frac{1}{2}\Big(\sfrac{1}{M_1}|\p_1|^2 + \sfrac{1}{M_2}|\p_2|^2 + |\p_3|^2\Big)
        - \bigg(\Frac{M_1}{|\r_1 - \r_3|} + \Frac{M_2}{|\r_2 - \r_3|} + \Frac{M_1 M_2}{|\r_1 - \r_2|}\bigg).
    \label{brezdim}
\end{equation}
Prosti parametri modela so $M_1$, $M_2$ in pa za\v cetni pogoji, ki jih je $2 \cdot 3d$, kjer je $d$
\v stevilo prostorskih dimenzij, ki so nam na voljo. \v Ce se dr\v zimo vezi, da je oddaljenost med zvezdama
na za\v cetku $1$, imamo en za\v cetni pogoj manj\footnote{Ena\v cba~\eqref{brezdim} velja tudi \v ce je
$\rho_0$ karkoli drugega.}.

\subsubsection{Smiselne vrednosti parametrov}
Ta hamiltonian je \v cisto splo\v sen za gibanje treh (ne nujno nebesnih) to\v ckastih teles pod vplivom sile
gravitacije. Da bodo zvezde res zvezde, si bomo za zgled vzeli res te\v zak planet, Jupiter, ki je \v se
vedno tiso\v c-krat la\v zji od na\v sega Sonca. Kot smiselna se zato zdi omejitev $M_{1,2} \geq 1000$.
Prav tako je smiselno, da so razdalje med zvezdama na za\v cetku res 1.

Za\v cetnih pogojev imamo torej $2 \cdot 3d - 1$. Smiselno je, da preverimo za $d = 2$ in za $d = 3$.

\subsection{Diskretizacija in integracija}

Na\v so re\v sitev bomo gledali ob diskretnih \v casih, kjer nas ni treba skrbeti za ekstrapolacijo
re\v sitve, saj je na\v s integrator simplekti\v cen in eksaktno v vseh redih ohranja simplekti\v cno
formo. Ne glede na to, kateri red integratorja bomo izbrali, bomo potrebovali $\exp\big(\delta
t\{\bullet,T\}\big) q_i$ in pa $\exp\big(\delta t\{\bullet,V\}\big) p_i$. Koordinate $i$-tega telesa bomo
ozna\v cili z $\r_k = (r_{k,1}, r_{k,2}, r_{k,3})^T$, njegove impulze pa s $\p_k = (p_{k,1}, p_{k,2}, p_{k,3})^T$.
Dobimo dve matriko koordinat in matriko impulzov, s komponentami $r_{k,\ell}$. Stolpci te matrike so bodisi
krajevni vektorji telesa, bodisi vektorji hitrosti tega telesa. Propagatorji za "`pol"' koraka se glasijo
\begin{align}
    \exp(c\ \delta t\{\bullet, T\}) r_{k,\ell}(t) &\approx r_{k,\ell}(t) + c\delta t\{r_{k,\ell}(t), T\} = r_{k,\ell}(t)
        + c\delta t \frac{p_{k,\ell}(t)}{M_\ell} \notag \\
    \exp(c\ \delta t\{\bullet, T\}) p_{k,\ell}(t) &= p_{k,\ell} (t) \notag \\
    \exp(c\ \delta t\{\bullet, V\}) r_{k,\ell}(t) &= r_{k,\ell} (t) \notag \\
    \exp(c\ \delta t\{\bullet, V\}) p_{k,\ell}(t) &\approx p_{k,\ell} (t) + c\delta t\{p_{k,\ell}(t), V\} = p_{k,\ell}(t)
        -c\delta t \der{V}{r_{k\ell}}
\end{align}
kjer je seveda $M_3 = 1$. Zadnji Poissonov oklepaj je tr\v si oreh, zato ga bomo zapisali posebej:
\begin{equation*}
    \{p_{k,\ell}, V\} = \sum_{i,j}\bigg(\der{p_{k\ell}}{r_{ij}}\der{V}{p_{ij}} - \der{p_{k\ell}}{p_{ij}}
        \der{V}{r_{ij}}\bigg) = - \der{V}{r_{k\ell}}.
\end{equation*}
Krajevni odvod potenciala lahko zapi\v semo kot
\begin{align*}
    -\der{V}{r_{k\ell}} =& \der{}{r_{k\ell}} \sum_{i=2}^N\sum_{j < i} M_i M_j \Big[\sum_m(r_{mi} - r_{mj})^2\Big]^{-1/2} \\
    =& \sum_{i=2}^N\sum_{j<i} M_i M_j \Big[\sum_m (r_{mi} - r_{mj})^2\Big]^{-3/2}
        \big(-\sfrac{1}{2}\big)\displaystyle{\der{}{r_{k\ell}}}\sum_n\big(r_{ni} - r_{nj}\big)^2 \\
    =& \sum_{i = 2}^N\sum_{j<i} \frac{M_i M_j}{-2\big[\sum_m (r_{mi} - r_{mj})^2\big]^{-3/2}}
        2(r_{ni} - r_{nj})(\delta_{i\ell} - \delta_{j\ell})\delta_{nk} \\
    =& -\sum_{j < \ell} M_\ell M_j\Big[\sum_m (r_{m\ell} - r_{mj})^2\Big]^{-3/2}(r_{k\ell} - r_{kj}) \\
    &- \sum_{i = \ell+1}^N M_{\ell} M_i\Big[\sum_m (r_{m\ell} - r_{mi})^2\Big]^{-3/2}(r_{k\ell} - r_{ki}) 
\end{align*}
Ta izraz lahko zapi\v semo bolj elegantno. Uvedemo operacijo se\v stevanja znotraj mno\v zice $\{1,2,3\}$:
\begin{align*}
    \pl : \mathbb{N} \times \mathbb{N} &\to \{1,2,3\} \\
    \pl : (m,n) &\mapsto (m + n - 1 \mod 3) + 1
\end{align*}
kar bomo ozna\v cevali kar z $m\pl n$. Odvod lahko potem prepi\v semo v dosti lep\v so obliko:
\begin{align}
    -\der{V}{r_{k\ell}} &= M_\ell M_{\ell \pl 1} \Big[\sum_m(r_{m,\ell} - r_{m,\ell\pl1})^2\Big]^{-3/2}(r_{k,\ell\pl1}
        - r_{k,\ell}) \notag \\
    &+ M_\ell M_{\ell\pl2}\Big[\sum_m(r_{m,\ell} - r_{m,\ell\pl2})^2\Big]^{-3/2}(r_{k,\ell\pl2} - r_{k,\ell}).
    \label{odvod}
\end{align}
Ena\v cba~\eqref{odvod} je seveda pri \v casu $t$.

\subsection{Izbira programskega orodja}

Na voljo imamo veliko paleto programskih jezikov. \v Casovno iteracijo bi bilo najbolj elegantno izvesti
v funkcijskem programskem jeziku, kot je npr {\tt Haskell}, vendar na\v se knjigovodstvo zajema samo 3
telesa v $d = 2$ in $d = 3$, zaradi \v cesar bomo uporabili {\tt Octave}.

\end{document}
